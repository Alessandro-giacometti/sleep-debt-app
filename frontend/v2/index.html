<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Sleep Debt Tracker</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>🛏️</text></svg>">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <!-- CSS Modulare -->
    <link rel="stylesheet" href="/static/v2/styles/variables.css">
    <link rel="stylesheet" href="/static/v2/styles/base.css">
    <link rel="stylesheet" href="/static/v2/styles/components.css">
    <link rel="stylesheet" href="/static/v2/styles/pages.css">
</head>
<body>
    <!-- Homepage -->
    <div id="homepage" class="homepage">
        <div class="container">
            <div class="header">
                <div class="header-top">
                    <div class="header-left">
                        <h1 class="header-title">😴 Sleep Debt Tracker</h1>
                        <p class="header-subtitle">Monitora il tuo debito di sonno</p>
                    </div>
                    <div class="header-right">
                        <div class="header-date" id="header-date"></div>
                    </div>
                </div>
            </div>

            <!-- Card Debito Principale -->
            <div class="card debt-main-card" id="debt-main-card">
                <button class="sync-btn-inline" id="sync-btn" onclick="syncData()">🔄</button>
                <div class="debt-label">
                    <span class="debt-label-icon">🛏️</span>
                    <span>Sleep Debt</span>
                </div>
                <div class="debt-value" id="debt-value">-</div>
            </div>

            <!-- Mini Card Zona e Cambiamento -->
            <div class="mini-cards">
                <div class="mini-card" onclick="showZonePage()">
                    <div class="mini-card-content">
                        <div class="mini-card-label">Sleep Debt Zone</div>
                        <div class="mini-card-value" id="current-zone">-</div>
                    </div>
                    <div class="mini-card-chevron">›</div>
                </div>
                <div class="mini-card">
                    <div class="mini-card-content">
                        <div class="mini-card-label">Daily Change</div>
                        <div class="mini-card-value" id="today-change">-</div>
                    </div>
                    <div class="mini-card-chevron">›</div>
                </div>
            </div>

            <!-- Grafico -->
            <div class="card chart-section">
                <div class="chart-header" onclick="openChartFullscreen()">
                    <div class="chart-title">
                        <span id="chart-title-text">Andamento del debito di sonno</span>
                        <span class="chart-title-chevron">›</span>
                    </div>
                    <span class="chart-toggle-icon" onclick="event.stopPropagation(); switchChartType()" style="font-size: 20px; cursor: pointer; opacity: 0.6;">📊</span>
                </div>
                <div class="chart-container">
                    <canvas id="main-chart"></canvas>
                </div>
            </div>

            <!-- Card Dormi Oggi e Obiettivo -->
            <div class="info-cards">
                <div class="info-card">
                    <div class="info-card-content">
                        <div class="info-card-label">Ore dormite oggi</div>
                        <div class="info-card-value" id="today-sleep">-</div>
                    </div>
                    <div class="info-card-chevron">›</div>
                </div>
                <div class="info-card">
                    <div class="info-card-content">
                        <div class="info-card-label">Target sonno giornaliero</div>
                        <div class="info-card-value" id="target-sleep">-</div>
                    </div>
                    <div class="info-card-chevron">›</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Pagina Impostazioni -->
    <div id="settings-page" class="settings-page">
        <div class="container">
            <div class="header">
                <h1 class="header-title">Impostazioni</h1>
            </div>

            <div class="settings-list">
                <div class="settings-row" onclick="showSettingsSubpage('window')">
                    <span class="settings-row-label">Finestra mobile del debito</span>
                    <div class="settings-row-value">
                        <span id="settings-window-value">7 giorni</span>
                        <span class="settings-row-chevron">›</span>
                    </div>
                </div>
                <div class="settings-row" onclick="showSettingsSubpage('target')">
                    <span class="settings-row-label">Target sonno giornaliero</span>
                    <div class="settings-row-value">
                        <span id="settings-target-value">8h 00m</span>
                        <span class="settings-row-chevron">›</span>
                    </div>
                </div>
                <div class="settings-row settings-row-toggle">
                    <span class="settings-row-label">UI V1</span>
                    <div class="settings-row-value">
                        <a href="/ui/v1" class="settings-toggle-switch">
                            <div class="settings-toggle-switch-slider"></div>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Sotto-pagina Finestra -->
    <div id="settings-window-subpage" class="settings-subpage">
        <div class="settings-subpage-header">
            <button class="settings-subpage-back" onclick="closeSettingsSubpage()">‹</button>
            <h2 class="settings-subpage-title">Finestra mobile del debito</h2>
        </div>
        <div class="pill-selector">
            <button class="pill-btn active" onclick="selectWindow(7)">7 giorni</button>
            <button class="pill-btn" onclick="selectWindow(14)">14 giorni</button>
            <button class="pill-btn" onclick="selectWindow(30)">30 giorni</button>
        </div>
    </div>

    <!-- Sotto-pagina Obiettivo -->
    <div id="settings-target-subpage" class="settings-subpage">
        <div class="settings-subpage-header">
            <button class="settings-subpage-back" onclick="closeSettingsSubpage()">‹</button>
            <h2 class="settings-subpage-title">Target sonno giornaliero</h2>
        </div>
        <div class="target-picker">
            <div class="target-picker-value" id="target-picker-value">8h 00m</div>
        </div>
    </div>

    <!-- Pagina Zone Debito -->
    <div id="zone-page" class="zone-page">
        <div class="zone-page-header">
            <button class="zone-page-back" onclick="closeZonePage()">‹</button>
            <h2 class="zone-page-title">Sleep Debt Zone</h2>
        </div>

        <div class="zone-main-card">
            <div class="zone-main-label">Debito di sonno attuale</div>
            <div class="zone-main-value" id="zone-main-value">-</div>
            <div class="zone-progress-bar" id="zone-progress-bar">
                <div class="zone-progress-slider" id="zone-progress-slider"></div>
            </div>
            <div class="zone-progress-markers">
                <div class="zone-progress-marker" style="left: 20%;">
                    <div class="zone-progress-marker-dot" style="background: var(--color-yellow);"></div>
                    <div class="zone-progress-marker-label">6h</div>
                </div>
                <div class="zone-progress-marker" style="left: 43.33%;">
                    <div class="zone-progress-marker-dot" style="background: var(--color-orange);"></div>
                    <div class="zone-progress-marker-label">13h</div>
                </div>
                <div class="zone-progress-marker" style="left: 80%;">
                    <div class="zone-progress-marker-dot" style="background: var(--color-red);"></div>
                    <div class="zone-progress-marker-label">24h</div>
                </div>
            </div>
        </div>

        <div class="zone-list">
            <div class="zone-item expanded" onclick="toggleZoneItem(this)">
                <div class="zone-item-header">
                    <div class="zone-item-left">
                        <div class="zone-item-icon optimal">✓</div>
                        <div>
                            <div class="zone-item-title">Ottimale</div>
                            <div class="zone-item-range">(&lt; 6 h)</div>
                        </div>
                    </div>
                    <span class="zone-item-chevron">›</span>
                </div>
                <div class="zone-item-content">
                    Il tuo debito di sonno è nella zona ottimale. Le tue prestazioni cognitive e fisiche sono al massimo livello.
                </div>
            </div>
            <div class="zone-item" onclick="toggleZoneItem(this)">
                <div class="zone-item-header">
                    <div class="zone-item-left">
                        <div class="zone-item-icon slight"></div>
                        <div>
                            <div class="zone-item-title">Lieve deficit</div>
                            <div class="zone-item-range">(6h - 13h)</div>
                        </div>
                    </div>
                    <span class="zone-item-chevron">›</span>
                </div>
                <div class="zone-item-content">
                    Il tuo debito di sonno è lieve. Potresti notare una leggera riduzione dell'energia durante la giornata.
                </div>
            </div>
            <div class="zone-item" onclick="toggleZoneItem(this)">
                <div class="zone-item-header">
                    <div class="zone-item-left">
                        <div class="zone-item-icon large"></div>
                        <div>
                            <div class="zone-item-title">Deficit moderato</div>
                            <div class="zone-item-range">(13h - 24h)</div>
                        </div>
                    </div>
                    <span class="zone-item-chevron">›</span>
                </div>
                <div class="zone-item-content">
                    Il tuo debito di sonno è moderato. Le tue prestazioni cognitive e fisiche potrebbero essere compromesse.
                </div>
            </div>
            <div class="zone-item" onclick="toggleZoneItem(this)">
                <div class="zone-item-header">
                    <div class="zone-item-left">
                        <div class="zone-item-icon critical"></div>
                        <div>
                            <div class="zone-item-title">Deficit elevato</div>
                            <div class="zone-item-range">(24h+)</div>
                        </div>
                    </div>
                    <span class="zone-item-chevron">›</span>
                </div>
                <div class="zone-item-content">
                    Il tuo debito di sonno è elevato. È importante recuperare il riposo per evitare conseguenze sulla salute e le prestazioni.
                </div>
            </div>
        </div>
    </div>

    <!-- Pagina Grafico Fullscreen -->
    <div id="chart-fullscreen" class="chart-fullscreen">
        <div class="chart-fullscreen-header">
            <button class="chart-fullscreen-back" onclick="closeChartFullscreen()">‹</button>
            <h2 class="chart-fullscreen-title">Sleep Debt Trend</h2>
        </div>

        <div class="chart-fullscreen-container">
            <canvas id="fullscreen-chart"></canvas>
        </div>

        <div class="chart-fullscreen-bar-container">
            <div class="chart-fullscreen-bar" id="chart-fullscreen-bar">
                <div class="chart-fullscreen-bar-marker" style="left: 0%;">
                    <div class="chart-fullscreen-bar-marker-dot"></div>
                    <div class="chart-fullscreen-bar-marker-label">6 h</div>
                </div>
                <div class="chart-fullscreen-bar-marker" style="left: 50%;">
                    <div class="chart-fullscreen-bar-marker-dot"></div>
                    <div class="chart-fullscreen-bar-marker-label">13 h e 30 min</div>
                </div>
                <div class="chart-fullscreen-bar-marker" style="left: 100%;">
                    <div class="chart-fullscreen-bar-marker-dot"></div>
                    <div class="chart-fullscreen-bar-marker-label">24 h e 23 min</div>
                </div>
            </div>
        </div>

        <div class="chart-fullscreen-selector">
            <button class="chart-fullscreen-selector-btn" onclick="selectDays(7)">7 Giorni</button>
            <button class="chart-fullscreen-selector-btn active" onclick="selectDays(10)">10 Giorni</button>
            <button class="chart-fullscreen-selector-btn" onclick="selectDays(14)">14 Giorni</button>
            <button class="chart-fullscreen-selector-btn" onclick="selectDays(30)">30 Giorni</button>
            <button class="chart-fullscreen-selector-btn" onclick="selectDays(90)">90 Giorni</button>
            <span class="chart-fullscreen-selector-icon" onclick="event.stopPropagation(); switchChartType()">📊</span>
        </div>
    </div>

    <!-- Navbar Inferiore -->
    <nav class="navbar-bottom">
        <button class="navbar-item active" onclick="showHomepage()">
            <span class="navbar-icon">🏠</span>
            <span>Home</span>
        </button>
        <button class="navbar-item" onclick="showSettings()">
            <span class="navbar-icon">⚙️</span>
            <span>Impostazioni</span>
        </button>
    </nav>

    <!-- JavaScript Modulare -->
    <script src="/static/v2/app.js"></script>
    <script src="/static/v2/js/navigation.js"></script>
    <script src="/static/v2/js/pages/homepage.js"></script>
    <script src="/static/v2/js/pages/settings.js"></script>
    <script src="/static/v2/js/pages/zone.js"></script>
    <script src="/static/v2/js/pages/chart.js"></script>
    <script src="/static/v2/charts.js"></script>
</body>
</html>
